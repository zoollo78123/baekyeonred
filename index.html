<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â„ï¸ë°±ì—° ê´€ë¦¬ ì‹œìŠ¤í…œâ„ï¸</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background: #000; color: #fff; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 550px; background: #111; padding: 25px; border: 1px solid #333; border-radius: 15px; box-shadow: 0 0 20px rgba(0,212,255,0.1); }
        h1 { text-align: center; letter-spacing: 12px; color: #fff; margin-bottom: 20px; font-size: 24px; }
        .section { background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border: 1px solid #222; }
        .section-title { font-size: 13px; color: #00d4ff; margin-bottom: 12px; font-weight: bold; border-left: 3px solid #00d4ff; padding-left: 10px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        label { font-size: 13px; color: #ccc; }
        input { width: 130px; padding: 8px; background: #000; border: 1px solid #333; color: #fff; text-align: right; border-radius: 5px; outline: none; font-size: 14px; }
        input:focus { border-color: #00d4ff; }
        .log-input { width: 100%; text-align: left; margin-bottom: 10px; box-sizing: border-box; }
        .btn-submit { width: 100%; padding: 15px; background: #00d4ff; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        
        .result-container { background: #fff; color: #000; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .total-box { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px double #eee; }
        .total-label { font-size: 14px; font-weight: bold; color: #2d3436; }
        .total-val { font-size: 24px; font-weight: 900; color: #d63031; display: block; }
        .bank-val { font-size: 20px; font-weight: 800; color: #0984e3; }

        .bm-detail-box { background: #f8f9fa; border: 1px solid #dfe6e9; border-radius: 8px; padding: 12px; margin-top: 10px; }
        .bm-detail-title { font-size: 13px; font-weight: bold; color: #2d3436; margin-bottom: 8px; border-bottom: 1px solid #ccc; padding-bottom: 4px; }
        .bm-row { display: flex; justify-content: space-between; font-size: 12px; color: #636e72; margin-bottom: 4px; }
        
        #admin_logs { margin-top: 20px; background: #000; padding: 15px; border-radius: 10px; border: 1px solid #333; font-size: 13px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <h1>â„ï¸ë°±ì—°â„ï¸</h1>

    <div class="section">
        <div class="section-title">ê¸°ë³¸ í’ˆëª©</div>
        <div class="row"><label>C4 ìˆ˜ëŸ‰ [ê°œë‹¹ 5ì–µ]</label><input type="number" id="c4" oninput="calc()"></div>
        <div class="row"><label>ê²€ì€ëˆ ìˆ˜ëŸ‰ [ê°œë‹¹ 1ë§Œ]</label><input type="number" id="bm" oninput="calc()"></div>
    </div>

    <div class="section">
        <div class="section-title">ë§ˆì•½ ë° ìœ„í</div>
        <div class="row"><label>ë°€ê°€ë£¨ [ê°œë‹¹ 300ë§Œ / 100ê°œ 3ì–µ]</label><input type="number" id="flour" oninput="calc()"></div>
        <div class="row"><label>ìƒ‰ì¢…ì´ [ê°œë‹¹ 300ë§Œ / 100ê°œ 3ì–µ]</label><input type="number" id="paper" oninput="calc()"></div>
    </div>

    <div class="section">
        <div class="section-title">ì´ê¸° ë° ë¬´ê¸°ë¥˜</div>
        <div class="row"><label>ì¹´ë¹ˆì†Œì´ [3ì–µ]</label><input type="number" id="g1" oninput="calc()"></div>
        <div class="row"><label>ì–´ì°íŠ¸ / ì»´ë±ƒ [1.5ì–µ]</label><input type="number" id="g2" oninput="calc()"></div>
        <div class="row"><label>SMG ì¢…ë¥˜ [2ì–µ]</label><input type="number" id="g3" oninput="calc()"></div>
        <div class="row"><label>íƒ„ì•½ [ê°œë‹¹ 20ë§Œ / 100ë°œ 2000ë§Œ]</label><input type="number" id="ammo" oninput="calc()"></div>
        <div class="row"><label>ê·¼ì ‘ë¬´ê¸° [1ì–µ]</label><input type="number" id="melee" oninput="calc()"></div>
    </div>

    <div class="result-container">
        <div class="total-box">
            <span class="total-label">ğŸ’° ì‹œë¯¼ì—ê²Œ ì´ ì§€ê¸‰í•  ê¸ˆì•¡</span>
            <span id="final_pay" class="total-val">0ì›</span>
        </div>
        
        <div class="total-box" style="border:none; margin:0;">
            <span class="total-label">ğŸ¦ ê³µë™ê³„ì¢Œ ì…ê¸ˆì•¡ (íŒë§¤ê°€ì˜ 30%)</span>
            <span id="total_b" class="bank-val">0ì›</span>
        </div>

        <div class="bm-detail-box">
            <div class="bm-detail-title">[ê²€ì€ëˆ í™•ì¸ ëª©ë¡]</div>
            <div class="bm-row"><span>ì„œë²„ ìˆ˜ìˆ˜ë£Œ (10%)</span><span id="bm_server_fee">0ì›</span></div>
            <div class="bm-row"><span>ì¡°ì§ ìˆ˜ìˆ˜ë£Œ (20%)</span><span id="bm_org_fee">0ì›</span></div>
            <div class="bm-row" style="font-weight:bold; color:#d63031; margin-top:5px; border-top:1px dashed #ccc; padding-top:4px;">
                <span>ì‹œë¯¼ ì§€ê¸‰ì•¡ (70%)</span><span id="bm_citizen_pay">0ì›</span>
            </div>
        </div>
    </div>

    <div class="section" style="margin-top:20px;">
        <div class="section-title">ğŸ“ íŒë§¤ ì¥ë¶€ ê¸°ë¡</div>
        <input type="text" id="log_seller" class="log-input" placeholder="íŒë§¤ì ì´ë¦„/ê³ ë²ˆ">
        <input type="text" id="log_buyer" class="log-input" placeholder="êµ¬ë§¤ì ì´ë¦„/ê³ ë²ˆ">
        <input type="text" id="log_link" class="log-input" placeholder="ë¡œê·¸ ë©”ì‹œì§€ ë§í¬ ë¶™ì—¬ë„£ê¸°">
        <button class="btn-submit" onclick="submitLog()">ê¸°ë¡ ì „ì†¡í•˜ê¸°</button>
    </div>

    <div id="admin_logs">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB8j4S7s63O_sunf2lugiNH9cjHCQYYTCo",
        authDomain: "backyeonred.firebaseapp.com",
        databaseURL: "https://backyeonred-default-rtdb.firebaseio.com",
        projectId: "backyeonred",
        storageBucket: "backyeonred.firebasestorage.app",
        messagingSenderId: "584492581087",
        appId: "1:584492581087:web:d887f5851826a4ab1be96a"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function formatWon(money) {
        money = Math.floor(money);
        if (money === 0) return "0ì›";
        let eok = Math.floor(money / 100000000);
        let man = Math.floor((money % 100000000) / 10000);
        return (eok > 0 ? eok + "ì–µ " : "") + (man > 0 ? man + "ë§Œ " : "") + "ì›";
    }

    function calc() {
        const getV = (id) => Number(document.getElementById(id).value) || 0;

        // 1. ê° í’ˆëª©ë³„ íŒë§¤ ì´ì•¡ ê³„ì‚° (1ê°œ ì…ë ¥ ì‹œ ê°œë‹¹ ê°€ê²©ìœ¼ë¡œ ê³„ì‚°ë¨)
        const c4_total = getV('c4') * 500000000;
        const flour_total = getV('flour') * 3000000; // 100ê°œì— 3ì–µì´ë¯€ë¡œ 1ê°œì— 300ë§Œ
        const paper_total = getV('paper') * 3000000; // 100ê°œì— 3ì–µì´ë¯€ë¡œ 1ê°œì— 300ë§Œ
        const g1_total = getV('g1') * 300000000;
        const g2_total = getV('g2') * 150000000;
        const g3_total = getV('g3') * 200000000;
        const ammo_total = getV('ammo') * 200000;    // 100ë°œì— 2000ë§Œì´ë¯€ë¡œ 1ë°œì— 20ë§Œ
        const melee_total = getV('melee') * 100000000;

        // ì¼ë°˜ í’ˆëª© ì „ì²´ í•©ê³„
        const general_sales_total = c4_total + flour_total + paper_total + g1_total + g2_total + g3_total + ammo_total + melee_total;

        // 2. ê²€ì€ëˆ ê³„ì‚° (ìœ ì§€)
        const bm_raw = getV('bm') * 10000;
        const bm_server_fee = bm_raw * 0.1;
        const bm_org_fee = bm_raw * 0.2;
        const bm_citizen_pay = bm_raw * 0.7;

        // 3. ìµœì¢… ê²°ê³¼ ì‚°ì¶œ
        // ì‹œë¯¼ ì§€ê¸‰ ì´ì•¡ = ì¼ë°˜ í’ˆëª© í•©ê³„ + ê²€ì€ëˆ ì§€ê¸‰ì•¡(70%)
        const final_pay = general_sales_total + bm_citizen_pay;

        // ê³µë™ê³„ì¢Œ ì…ê¸ˆì•¡ = (ì¼ë°˜ í’ˆëª© íŒë§¤ê°€ì˜ 30%) + (ê²€ì€ëˆ ì¡°ì§ìˆ˜ìˆ˜ë£Œ 20% ì „ì•¡)
        // ê²€ì€ëˆ ì¡°ì§ìˆ˜ìˆ˜ë£ŒëŠ” ì¡°ì§ì˜ ìˆ˜ìµì´ë¯€ë¡œ ê·¸ ìˆ˜ìµì„ ê³µê³„ì— ë„£ëŠ” ê²ƒì¸ì§€, 
        // ì•„ë‹ˆë©´ ê²€ì€ëˆë„ ì „ì²´ì˜ 30%ë¥¼ ë„£ëŠ” ê²ƒì¸ì§€ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ 
        // ë¬¸ë§¥ìƒ ì¡°ì§ ìˆ˜ìµì¸ "ì¡°ì§ ìˆ˜ìˆ˜ë£Œ 20%"ë¥¼ ê³µê³„ë¡œ ì·¨ê¸‰í•˜ê±°ë‚˜ 
        // ì¼ë°˜í’ˆëª©ì²˜ëŸ¼ "íŒë§¤ê°€(1ë§Œ)ì˜ 30%"ë¥¼ ë„£ëŠ” ê²ƒìœ¼ë¡œ í•´ì„ë©ë‹ˆë‹¤.
        // ì—¬ê¸°ì„œëŠ” ì¼ë°˜ í’ˆëª©ì€ íŒë§¤ê°€ì˜ 30%, ê²€ì€ëˆì€ ì¡°ì§ìˆ˜ìˆ˜ë£Œ(20%)ë¥¼ í•©ì‚°í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
        const total_bank = (general_sales_total * 0.3) + bm_org_fee;

        // í™”ë©´ ì—…ë°ì´íŠ¸
        document.getElementById('final_pay').innerText = formatWon(final_pay);
        document.getElementById('total_b').innerText = formatWon(total_bank);
        
        document.getElementById('bm_server_fee').innerText = formatWon(bm_server_fee);
        document.getElementById('bm_org_fee').innerText = formatWon(bm_org_fee);
        document.getElementById('bm_citizen_pay').innerText = formatWon(bm_citizen_pay);
    }

    function submitLog() {
        const seller = document.getElementById('log_seller').value;
        const buyer = document.getElementById('log_buyer').value;
        const link = document.getElementById('log_link').value;
        const amount = document.getElementById('final_pay').innerText;
        const bank_deposit = document.getElementById('total_b').innerText;

        if(!seller || !buyer || !link || (getV('c4') + getV('bm') + getV('flour') + getV('g1')) === 0) {
            alert("íŒë§¤ ë‚´ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return;
        }

        database.ref('logs').push({
            date: new Date().toLocaleString(),
            seller: seller,
            buyer: buyer,
            amount: amount,
            bank_deposit: bank_deposit,
            link: link
        }).then(() => {
            alert("ê¸°ë¡ ì™„ë£Œ! â„ï¸");
            document.getElementById('log_buyer').value = "";
            document.getElementById('log_link').value = "";
        });
    }

    database.ref('logs').on('value', (snapshot) => {
        const logBox = document.getElementById('admin_logs');
        logBox.innerHTML = "";
        const data = snapshot.val();
        if(!data) return;
        Object.keys(data).reverse().forEach(key => {
            const item = data[key];
            const div = document.createElement('div');
            div.style.borderBottom = "1px solid #222";
            div.style.padding = "10px 0";
            div.innerHTML = `
                <div style="color:#00d4ff; font-size:11px;">[${item.date}]</div>
                <div><b>${item.seller}</b> â” <b>${item.buyer}</b></div>
                <div style="color:#ff7675;">ì§€ê¸‰: ${item.amount} / ê³µê³„: ${item.bank_deposit}</div>
            `;
            logBox.appendChild(div);
        });
    });

    function getV(id) { return Number(document.getElementById(id).value) || 0; }
</script>
</body>
</html>
